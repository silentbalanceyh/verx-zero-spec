ifndef::imagesdir[:imagesdir: ../images]
:data-uri:
:table-caption!:

==== 表单组合

前文中提到的是 `_form` 配置节点，除了此节点以外，表单配置还支持 **按行组合** 的方式对表单碎片 **从上到下** 的布局模式，这种模式属于 **表单组合**（参考 `Ex.yoForm` 函数）：

[TIP]
====
每一个表单都遵循本章的表单结构，系统会将 `ui` 按顺序合并，下边表格是按默认顺序枚举的表格，从上到下的流式布局，其中 `additional.formRules` 是一个 `[]`，可以按照 **编码** 重新定义表单片段的顺序。

`additional` 在很多前端API都出现过，一般前端的API的默认常用术语如下：

- `data`：数据变量，存储了当前API处理的数据信息，`dataJ - Object、dataA = Array`。
- `config / options`：配置变量，存储了当前API处理数据依赖的配置数据信息，一般用 `config`，部分场景中使用 `options`。
- `additional`：附加配置，通常是 **编程模式** 专用配置变量，当某些API依赖外层调用编程方式传入配置时，用此变量。

表单配置中就是使用了 `additional` 作编程兼容，而 `data / config` 都来自 React 组件的 props 中。
====

表单**片段**完整如：

[options="header",cols="3,1,6"]
|====
|配置项|编码|含义
|`additional.form` | `FP` |（编程模式）`Form Program`：表单配置中第一个片段，依赖 `yoForm` 的 `additional` 参数。
|`_formUp` | `FU` |（上半部分）`Form Up`：前端 `Cab` 对应的资源文件中的定义，配置模式表单。
|`props.$options.formUp`| `PFU` |（上半部分）`Prop Form Up`：从组件属性传入的表单配置。
|`state.$formS.formUp`| `SFU` |（上半部分）`State Form Up`：一般是服务端配置专用，访问远程Ajax拉取表单片段。
|`_form` | `FF` |（主表单）`Form Focus`：**标准配置**，前端 `Cab` 对应资源文件中定义的标准表单配置。
|`props.$options.form`| `PFF` |（主表单）`Prop Form Focus`：从组件属性传入的表单配置。
|`state.$formS.form`| `SFF` |（主表单）`State Form Focus`：一般是服务端配置专用，访问远程Ajax拉取表单片段。
|`state.$formW`| `WFF` |（工作流）`Workflow Form Focus`：**扩展**，工作流专用表单配置。
|`_formDown` | `FD` |（下半部分）`Form Down`：前端 `Cab` 对应的资源文件中定义，配置模式表单。
|`props.$options.formDown`| `PFD` |（下半部分）`Prop Form Down`：从组件属性传入的表单配置。
|`state.$formS.formDown`| `SFD` |（下半部分）`State Form Down`：一般是服务端配置专用，访问远程Ajax拉取表单片段。
|====

参考下边的表单组合原理图理解此处的表单合并过程：

image:exp-form-segment.png[,960]

从上述原理图解析：

1. 编程模式直接扩展通常使用 `additional` 中的配置，优先级比较高，除此之外，若是自定义组件，编程模式还可以：
+
--
- 父组件更改配置之后传入子组件中填充 `$options` 变量，上层编程配置。
- 当前组件更改状态之后更新 `$formS` 变量（ Server Form ），本层编程配置。
--
2. 标准处理中 `$formS` 的含义为 `Server Form`，即通常用于从远程 Ajax 接口拉取表单配置，服务端三种配置一般如：
+
--
- **动态配置**：这种模式不启用 **表单组合** 功能，纯动态配置，上边原理图会失效。
- **组合配置**：这种模式中通常会拉取远程 `X_MODULE` 中的配置并执行解析，最终会将服务端的表单配置存储到 `$formS` 变量中。
- **工作流**：这种配置只有一个 **扩展**，目前是工作流专用，和工作流中的节点绑定的专用配置。
--
3. 顺序调整：上边提供的编排是 Zero Ui 提供的默认表单组合配置，您也可以在编程过程中更改 `formRules` 根据 **编码** 更改您想要的表单片段。
4. 除 **工作流** 之外，所有的表单源都提供了：**上、中、下** 三种模式，再结合：**编程、前端配置、后端配置** 三种情况，实际形成了一个表单组合的九宫格，这种模式下已经可以满足大部分表单的组合流程了。

[WARNING]
====
**表单组合** 这种模式只适用于行交换，简单说不可以做单行中的列切换，如某一行有：`姓名、电话、邮箱`，那么当它在 **表单组合** 中切换时，这三个属性的行顺序不可以变更。

若对表单执行切分，**原子级** 的单元是属性（字段），而在 Zero Ui 中由于有 Grid 布局，又多了一级：**行级**，**表单组合** 实际在 **行级** 之上为表单又创建了一级：**区域级**，这样设计的目的实际是简化开发和配置工作量，下边两种场景不适合 **表单组合**：

- 动态配置：若您的表单以来后端 `zero-ui` 中的 `UI_FORM` 来执行配置，那么此时不可以使用 **表单组合**，这种场景下由于定制的粒度已经可以到 **原子级**，所以不再依赖 **表单组合** 来实现复杂的表单布局，这种模式是最好的，但依赖 **开发中心** 和配置结果。
- 具象编程：这种模式就是表格中的 **标准模式**，一般模型是固定的，不依赖任何扩展、继承、多态的概念，表单后台绑定的模型本身已经属于 **不用拆分** 的场景，所以这种情况也不依赖 **表单组合**，目前大量的开发都是这种模式。

**表单组合** 是 Zero Ui 提供的兼容了纯动态和纯编程两种模式的一种折中形态，折中形态一方面可以减少编程量和配置量，另外一方面表单本身可以使用“搭积木”的方式来完成，表单内置实现了模块化布局。
====
