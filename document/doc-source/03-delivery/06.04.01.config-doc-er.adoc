ifndef::imagesdir[:imagesdir: ../images]
:data-uri:
:table-caption!:

=== 概念模型[[__CONFIG_DOC_CONCEPT]]

==== ER结构图

`zero-doc` 模块中的 ER 结构图如下：

image:zdoc-er.png[,1024]

[TIP]
====
上述ER结构图中，不同颜色节点含义会有所区别：

- 绿色：主实体，主要针对两种核心场景：*考卷场景*、*文档结构化*。
- 橙色：广义关联场景，可以使用橙色实体广义关联到任意可用的模型（identifier,key）。
- 蓝色：辅助实体，针对上述两种场景的辅助型概念表
====

==== 表说明

上述ER结构图中的表的概念说明如下：

[options="header",cols="15,15,70"]
|====
|表|概念|说明
|`D_DOC`|文档|用于 *结构化* 描述文档的主入口表，若您的系统中存在和文档关联的表结构信息，则可以使用额外的表和主表做 `1:1` 连接实现实体的完整性。
|`D_DOC_SEGMENT`|章节|*结构化* 将文档划分为树型结构的关键表，使用 *片段* 的含义在于它可以表示不同的概念，为文档结构化的 *第一维度* 视角的树型结构定义：`序、目录、正文、附录、章节、子章节、列表项` 等。
|`D_DOC_CLAUSE`|横向文本 a|横向文本作为整个文档结构中的 *第二维度* 视觉的内容，可以从树型结构中的文档中提取相关信息产生线性和树型两种不同的描述文本，最典型如：

- 针对某一段文字的文本批注信息。
- 针对某几个章节抽取出来的详细文本注释，形成线性维度章节，如 `条款`。
- 提炼某一篇文章的中心思想等内容。

横向文本本身具有 *树型* 结构可构成父子级的结构，而针对 *文档* 本身而言，可形成水平结构的基础描述信息。
|`D_REFER`|关联表 a|关联表用于描述不同实体之间的关联关系，现阶段支持四种类型的两两关联关系：

- `DOC` / 文档
- `SEGMENT` / 章节
- `CLAUSE` / 横向文本
- `PAPER` / 考卷（考试模型）
|`D_COMMENT`|备注 a|（广义关联）备注属于基本的备注信息，如您可以针对任意一个实体进行批注，且批注可以重复，如：解读信息、笔记信息等，从设计上 `D_DOC_CLAUSE` 和 `D_COMMENT` 的区别在于：

- `D_DOC_CLAUSE` 属于结构化的，整篇文章中只有 `D_DOC_CLAUSE` 部分是支持相互之间的结构化和引用关系的。
- `D_COMMENT` 属于独立备注，不支持任意结构化的内容，通常针对叶节点可多记录处理。
|`D_RESULT`|反馈|（广义关联）反馈主要针对特定场景中的内容进行信息反馈，且具备 *打分* 功能，可对目标文本进行评级、定级等。
|`D_EXAM`|考试/活动|定义一次完整的考试、活动等相关内容，如：一次审计、一次评价、一次考试，为单次活动的主体表结构，此表中存储了活动的基本信息，可同时支持线上线下不同的模式。
|`D_PAPER`|考卷|针对单次活动发放的完整考卷，考卷属于文档类型，且可以出现在 `D_REFER` 的关联中形成广义关联模型，且某次活动可以包含不同的考卷发放（包括AB卷）等。
|`D_PAPER_REF`|考卷题目/实例|此表描述了当前这次考卷筛选的题目的详细清单，以及题目的基本规则，为了保证试题可重用，所以才会有单独的考卷题目表用来筛选一次考卷中所有的题目基本信息。
|`D_REPLY`|答题卡|答题卡模型为用户参与调查和考试的主模型，针对一场考试的某一份试卷，一个用户只能提交一份答题卡，答题卡记录了当前考试试卷的基本信息记录。
|`D_REPLY_ITEM`|答题项|答题项为答题卡的 *子模型*，它不属于某试卷，而是针对一个题目提供的答题基本信息。
|`D_QSTORE`|题库|按照不同的分类维度创建对应的题库，用来对问题进行分类存储和管理。
|`D_QUESTION`|题目|题目存储于题库中，且在考试过程中可直接筛选考卷信息从题库中抽取来生成考卷实例，它的存储管理依赖 *题库* 实体。
|`D_QANSWER`|答案|答案卡主要用于描述带有 *选择性* 题目的答案相关信息，如单选题、多选题、判断题，您可以提供题目的可答题的项等相关信息。
|`D_QRULE`|逻辑规则 a|逻辑规则表一般从答题内容出发，根据答题内容触发相关规则来对本次试卷产生影响：

- 可影响试卷上题目的基础规则：显示、隐藏、必答、选答。
- 限定试卷上某个题目或某些题目的回答轨迹：更改题目的基本回答轨迹。
- 自定义规则，对题目的基本评分有所影响。
|====

==== 状态机

image:zdoc-status.png[,720]

[options="header",title="状态说明",cols="1,1,8"]
|====
|状态|值|说明
|草稿|`DRAFT`|一份文档在编辑到正式发布之前的状态，可执行阶段性编辑，编辑完成后经过发布才会走入下一个状态（ *发布流* ）。
|已发布|`RELEASE` a|正式发布后的文档可选择两种模式的后续操作：

- 直接针对这种类型的文档进行管理，此种管理为发布后管理，管理内容所见即所得。
- 针对已发布的文档，可执行活动申请进入可运行的基础状态。
|运行中|`RUNNING`|若一个文档关联到一次活动 `D_EXAM`，则本文档进入 *运行中* 的状态，活动运行期间的文档会被锁定不可编辑。
|已结束|`STOPPED` a|活动结束之后的文档会进入 *已结束* 的状态，这种状态会存在后期处理：

- 直接归档成历史文档保存起来形成底稿（不再使用的文档，一般是考卷）。
- 将此文档再次转换成 *已发布* 状态持续使用（可重复使用的文档，审计底稿、制度、规范、标准文档）。
|已归档|`ARCHIVE`|若一个文档被归档会形成历史文档，历史文档只能作为新文档的创建起点起草，但这种模式是创建一份新的文档，所以历史文档不可再使用。
|待审批|`PENDING`|若文档起草流程中启用了 *审批流*，那么文档提交之后会变成 *待审批* 状态，审批完成之后才会进入 *已发布* 状态。
|已拒绝|`REJECTED` a|若文档审批未通过，则进入 *已拒绝* 的状态，已拒绝的文档有两个后续流程：

- 直接归档，结束文档的生命周期。
- 重新打回到草稿状态重新编辑，编辑完成后走下一次 *审批流*。
|====

==== 类型/类别

类型和类别在整个Zero扩展模块中通常使用两个不同的属性来描述：

- `type`：描述类型，主维度，一般在类型上可以直接将某个实体进行区分，一般使用 `X_TABULAR` 存储线性下拉。
- `category`：描述类别，业务维度树，主要用来描述当前实体的 *业务归属*，一般使用 `X_CATEGORY` 存储树型选择器。


`type` 的类型描述通常会和广义关联模型配合使用，但类型本身不存在关联关系，但可作为关联的起点对待，其拓扑结构图如下：

image:zdoc-type.png[,960]

所以理解 `type` 的关键是区分 *广义关联* 和数据库级别设计层的 *继承多态* 的相关性行为，关于 `MODEL_ID / MODEL_KEY` 的结构在 Zero 扩展模块中很多地方都有所涉猎，除开这两个常用属性之外，有些关联实体表中还存在 `MODEL_CATEGORY` 用于和主表中的 `category` 记录对齐而形成如下关联结构：

- `type / identifier`：元数据级的关联关系（ `TYPE / MODEL_ID` ）。
- `category`：数据集的业务维度描述的关联关系（ `CATEGORY / MODEL_CATEGORY`）。
- `key`：数据集的记录描述关联关系（ `KEY / MODEL_KEY`）。

上述结构模型在整个Zero框架扩展模块中很场景，也形成了约定俗成的基本规范。