ifndef::imagesdir[:imagesdir: ../images]
:data-uri:
:table-caption!:

== Zero中的查询引擎

[WARNING]
====
那些张口就来肯定一个东西的优缺点、自己没使用过的无脑观点就不聊了，曾经有人给我疯狂吐槽Jooq的性能问题，但从目前我们系统的表现看起来，虽然性能不是最优，但也不至于到他说的那种程度，评估一个东西请用正常模式，别推一样踩一样。

软件工程师最忌讳的一个点就是 *信仰主义*。
====

=== 查询引擎基础

==== Jooq总结

Zero内置使用了Jooq做底层数据访问，它的优缺点如下：

优点：

- 类型安全：Jooq支持强类型的查询，减少了错误和歧义的可能性，从而使代码更加可靠和安全。
- 可读性高：Jooq生成的代码类似于SQL语句，易于理解和维护，同时还提供了高级功能，如内部联接和复杂查询。
- 易于使用：Jooq提供了简单易懂的API，使开发人员可以快速编写和执行数据库查询。
- 与多种数据库兼容：Jooq支持多种数据库，包括MySQL、PostgreSQL、Oracle等，这使得它适用于不同的项目和团队。
- 可扩展性强：Jooq允许开发人员添加自定义数据类型和操作符，以支持特定的业务需求和数据库类型。
- 支持多种数据库特性：Jooq支持许多数据库特性，如分页、事务、聚合、分组等，这使得开发人员可以轻松地使用这些功能而不必担心不同数据库之间的兼容性。

缺点：

- 学习曲线较陡峭：Jooq的API相对复杂，需要一定的学习和实践才能熟练掌握。
- 不支持所有数据库特性：虽然Jooq支持许多数据库特性，但并不支持所有功能。因此，在使用Jooq之前，需要确认所需的功能是否得到支持。
- 生成的代码量较大：Jooq生成的代码相对较多，可能会导致代码库变得复杂和冗长，从而增加了维护的难度。
- 比较笨重：相对于其他数据库访问库，Jooq的代码库比较庞大，可能会对应用程序的性能产生一定的影响。
- 文档不够完善：Jooq的文档不够详尽和全面，可能需要花费更多时间和精力来学习和理解其使用方法和技巧。

[CAUTION]
====
Jooq的性能影响因素主要包含如下几点：

* 复杂的查询语句：Jooq支持复杂的查询语句，但这些语句可能会导致性能下降，尤其是当查询的数据量非常大时。在这种情况下，可以考虑使用更简单和直接的查询语句，以提高性能。
* 非优化的数据库表结构：如果数据库表结构设计不良，会对Jooq的性能产生影响。例如，如果表中有太多的冗余字段、重复的数据或过度归一化的设计，都会增加查询和更新的成本。
* 大量数据的操作：当处理大量数据时，Jooq的性能可能会受到影响。这时可以考虑使用批量插入或更新操作，以减少数据库交互的次数，从而提高性能。
* 过多的SQL语句：如果使用Jooq时生成了过多的SQL语句，会对性能产生负面影响。这时可以考虑通过使用缓存或重构查询语句来减少SQL语句的生成次数，以提高性能。
* 应用程序本身的性能问题：Jooq本身的性能问题可能并不是最终的瓶颈。在一些情况下，应用程序本身的性能问题，如磁盘I/O或网络延迟等，可能会对Jooq的性能产生更大的影响。

====

==== Qr引擎

Zero中为SQL语法提供了 Qr（Query Result） 的查询引擎语法，语法本身是JSON格式，在前后端可以通过代码直接提取数据或构造不同的查询语法，查询引擎的好处：

1. Zero为查询引擎提供了前后端同步的API，不论在前端还是后端都提供了查询引擎语法树，您可以很方便地将查询条件进行转换、计算、合并等各种操作。
2. Json语法格式简单，开发人员很容易理解查询引擎语法，并根据业务需求提炼复杂的查询条件。
3. 前端组件中有很多和查询相关的内容，统计、视图定制、排序、列表，所有和数据特性相关的运算可直接使用查询引擎完成，不需要针对特定场景开发对应接口（项目赶进度比较重要）。
4. Zero底层对语法树做过三种不同算法层面的优化，只需识别模型即可处理各种复杂的优化查询，从目前生产环境表现看起来还算 *稳定靠谱*。
5. Zero针对底层查询执行了跨表类处理（JOIN），跨表所有数据库级别的 *DML* 操作都使用同样的API实现，如此就解决了用户在复杂业务跨表操作的问题，包括多表同读和多表同写。

[TIP]
====
查询引擎语法同样适用于动态建模项目（zero-atom）中，只要在Zero框架中和数据库打交道，不论注释文档中书写提到了查询引擎（QR）部分，都可直接使用查询引擎语法搞定。

除此之外，`spring-up` 项目中还可以将查询引擎语法用于Spring框架，只是需要依赖 `QueryDSL` 项目。
====

=== 语法说明

参考： link:https://lang-yu.gitbook.io/zero/000.index/010.jooq#san-cha-xun-yin-qing[1.10.珷玞：Jooq,window="_blank"]

include::01.01.core-qr-syntax.adoc[]
include::01.02.core-qr-list.adoc[]